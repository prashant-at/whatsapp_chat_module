<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Admin rule: grant full access to WhatsApp administrators -->
    <record id="whatsapp_connection_admin_all" model="ir.rule">
        <field name="name">WhatsApp Connection: Admin Full Access</field>
        <field name="model_id" ref="whatsapp_chat_module.model_whatsapp_connection"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('whatsapp_chat_module.group_whatsapp_admin'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="True"/>
    </record>
    <!-- Record rule: Users and Managers can read connections where they are authorized -->
    <!-- Note: Empty authorized_person_ids connections are only accessible to administrators (who bypass rules) -->
    <record id="whatsapp_connection_read_rule" model="ir.rule">
        <field name="name">WhatsApp Connection: Read Authorized Only</field>
        <field name="model_id" ref="whatsapp_chat_module.model_whatsapp_connection"/>
        <field name="domain_force">[('authorized_person_ids', 'in', [user.id])]</field>
        <field name="groups" eval="[(4, ref('whatsapp_chat_module.group_whatsapp_user')), (4, ref('whatsapp_chat_module.group_whatsapp_manager'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="False"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <!-- Record rule: Users and Managers can write connections where they are authorized -->
    <!-- Note: Empty authorized_person_ids connections are only accessible to administrators (who bypass rules) -->
    <!-- Note: This rule is limited by ACLs - only Admin has write/create/unlink permissions in ACLs -->
    <record id="whatsapp_connection_write_rule" model="ir.rule">
        <field name="name">WhatsApp Connection: Write Authorized Only</field>
        <field name="model_id" ref="whatsapp_chat_module.model_whatsapp_connection"/>
        <field name="domain_force">[('authorized_person_ids', 'in', [user.id])]</field>
        <field name="groups" eval="[(4, ref('whatsapp_chat_module.group_whatsapp_user')), (4, ref('whatsapp_chat_module.group_whatsapp_manager'))]"/>
        <field name="perm_read" eval="False"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="False"/>
        <field name="perm_unlink" eval="False"/>
    </record>
</odoo>

