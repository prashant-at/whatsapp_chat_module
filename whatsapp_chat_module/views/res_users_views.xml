<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Extend res.users form view to add WhatsApp default connection field and connections tab -->
    <record id="view_users_form_whatsapp_extension" model="ir.ui.view">
        <field name="name">res.users.form.whatsapp.extension</field>
        <field name="model">res.users</field>
        <field name="inherit_id" ref="base.view_users_form"/>
        <field name="arch" type="xml">
            <!-- Add default connection field in the Access Rights page -->
            <!-- <xpath expr="//page[@name='access_rights']//field[@name='groups_id']" position="after">
               
            </xpath> -->
            
            <!-- Add WhatsApp Connections tab -->
            <xpath expr="//notebook" position="inside">
                <page string="WhatsApp Connections" name="whatsapp_connections">
                    <group>
                        <group>
                       <field name="whatsapp_default_connection_id" 
                       widget="many2one"
                       options="{'no_create': True, 'no_open': True}"/>
                        </group>
                    </group>
                    <field name="authorized_whatsapp_connection_ids" 
                           nolabel="1"
                           readonly="1"
                           mode="tree"
                           options="{'limit': 10, 'no_open': True}">
                        <tree string="Authorized Connections" 
                              create="0" 
                              delete="0" 
                              edit="0"
                              default_order="is_default desc, name">
                            <field name="name" string="Connection Name" optional="show"/>
                            <field name="from_field" string="From" optional="show"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>
</odoo>

